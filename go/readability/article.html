<!DOCTYPE html>
<html>

<head>
    <title>Article Content</title>
    <link rel="stylesheet" href="/static/style.css" />
    <style id="user-style"></style>
    {{if .Style}}
    <style>{{.Style}}</style>
    {{end}}
</head>

<body>
    <h1>{{.Title}}</h1>
    <form onsubmit="applyStyle(event)">
        <textarea id="style-input" rows="5" cols="50" placeholder="Enter CSS style here"></textarea>
        <br>
        <input type="submit" value="Apply Style">
    </form>
    <button onclick="shareLink()">Share</button>
    {{if .ErrMsg}}
    <p>{{.ErrMsg}}</p>
    {{else}}
    <div class="content">
        {{.Content | safeHTML}}
    </div>
    {{end}}
    <script>
        function applyStyle(event) {
            event.preventDefault();
            var styleInput = document.getElementById('style-input').value;
            var userStyle = document.getElementById('user-style');
            userStyle.innerHTML = styleInput;
        }

        function shareLink() {
            var styleInput = document.getElementById('style-input').value;
            var currentURL = window.location.pathname;

            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/share", true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);
                    if (response.success) {
                        window.location.href = response.redirectTo;
                    } else {
                        console.log("Error sharing link:", response.error);
                    }
                }
            };
            var data = JSON.stringify({ path: currentURL, style: styleInput });
            xhr.send(data);
        }
    </script>
</body>

</html>
